{% extends "base.html" %}
{% block title %}{% if is_create %}New Project{% else %}Edit Project{% endif %}{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-3">{% if is_create %}New Project{% else %}Edit Project{% endif %}</h1>

  <form method="post" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-3">
      <label for="{{ form.name.id_for_label }}" class="form-label">Name</label>
      {{ form.name }}
      {% if form.name.errors %}<div class="text-danger small mt-1">{{ form.name.errors }}</div>{% endif %}
    </div>

    <div class="mb-3">
      <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
      {{ form.description }}
      {% if form.description.errors %}<div class="text-danger small mt-1">{{ form.description.errors }}</div>{% endif %}
    </div>

    <div class="row g-3">
      <div class="col-md-6">
        <label for="{{ form.start_date.id_for_label }}" class="form-label">Start date</label>
        {{ form.start_date }}
        {% if form.start_date.errors %}<div class="text-danger small mt-1">{{ form.start_date.errors }}</div>{% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.end_date.id_for_label }}" class="form-label">End date</label>
        {{ form.end_date }}
        {% if form.end_date.errors %}<div class="text-danger small mt-1">{{ form.end_date.errors }}</div>{% endif %}
      </div>
    </div>

    <div class="row g-3 mt-1">
      <div class="col-md-6">
        <label for="{{ form.status.id_for_label }}" class="form-label">Status</label>
        {{ form.status }}
        {% if form.status.errors %}<div class="text-danger small mt-1">{{ form.status.errors }}</div>{% endif %}
      </div>
      <div class="col-md-6">
        <label for="{{ form.stakeholders.id_for_label }}" class="form-label">Stakeholders</label>
        {{ form.stakeholders }}
        {% if form.stakeholders.errors %}<div class="text-danger small mt-1">{{ form.stakeholders.errors }}</div>{% endif %}
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button type="submit" class="btn btn-primary">Save</button>
      {% if is_create %}
        <a href="{% url 'projects:project_list' %}" class="btn btn-secondary">Cancel</a>
      {% else %}
        <a href="{% url 'projects:project_detail' pk=project.pk %}" class="btn btn-secondary">Cancel</a>
      {% endif %}
    </div>
  </form>
</div>
{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  if (window.flatpickr) {
    const start = document.getElementById('id_start_date');
    const end = document.getElementById('id_end_date');
    const fmt = { dateFormat: 'Y-m-d', allowInput: true };
    if (start) {
      window.flatpickr(start, Object.assign({}, fmt, {
        onChange: function(selectedDates) {
          if (end && selectedDates && selectedDates[0]) {
            end._flatpickr && end._flatpickr.set('minDate', selectedDates[0]);
          }
        }
      }));
    }
    if (end) {
      window.flatpickr(end, fmt);
    }
  }
});
</script>
{% endblock %}
